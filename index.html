<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Earthmover Parts AI Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }

        .safe-area-bottom { padding-bottom: env(safe-area-inset-bottom); }

        .glass-morphism {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
        }

        .app-gradient {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }

        @keyframes pulse-glow {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
        .pulse-btn { animation: pulse-glow 2s infinite; }

        .scanner-line {
            height: 3px;
            background: linear-gradient(to right, transparent, #3b82f6, transparent);
            width: 100%;
            position: absolute;
            top: 0;
            left: 0;
            animation: scan 2.5s linear infinite;
            box-shadow: 0 0 15px #3b82f6;
        }

        @keyframes scan {
            0% { top: 0; }
            50% { top: 100%; }
            100% { top: 0; }
        }

        .view-transition { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        
        .history-card {
            transition: transform 0.2s ease;
        }
        .history-card:active {
            transform: scale(0.98);
        }

        /* Custom Scrollbar */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen pb-28">

    <!-- App Header -->
    <div class="app-gradient text-white px-6 pt-10 pb-14 rounded-b-[2.5rem] shadow-2xl relative overflow-hidden">
        <div class="absolute top-0 right-0 w-64 h-64 bg-blue-500/10 rounded-full -mr-20 -mt-20"></div>
        <div class="relative z-10 flex items-center justify-between">
            <div>
                <h1 class="text-2xl font-black tracking-tight italic">EARTHMOVER AI</h1>
                <p class="text-blue-400 text-xs font-bold tracking-widest uppercase">Parts Recognition System</p>
            </div>
            <div id="syncIndicator" class="flex items-center gap-2 bg-white/10 px-3 py-1.5 rounded-full backdrop-blur-md">
                <div class="h-2 w-2 rounded-full bg-green-400 animate-pulse"></div>
                <span class="text-[10px] font-bold">LIVE SYNC</span>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <main id="mainContainer" class="px-4 -mt-8 relative z-20">
        
        <!-- Tab Navigation -->
        <div id="viewToggle" class="flex gap-2 mb-6 bg-white/50 p-1 rounded-2xl backdrop-blur-sm border border-white overflow-x-auto no-scrollbar">
            <button onclick="switchAppView('home')" id="tab-home" class="flex-1 min-w-[80px] py-3 text-[11px] font-black uppercase tracking-tighter rounded-xl transition-all bg-white shadow-sm text-blue-600">Scanner</button>
            <button onclick="switchAppView('history')" id="tab-history" class="flex-1 min-w-[80px] py-3 text-[11px] font-black uppercase tracking-tighter rounded-xl transition-all text-slate-400">History</button>
            <button onclick="switchAppView('catalog')" id="tab-catalog" class="flex-1 min-w-[80px] py-3 text-[11px] font-black uppercase tracking-tighter rounded-xl transition-all text-slate-400">Catalog</button>
        </div>

        <!-- HOME VIEW (Scanner) -->
        <div id="view-home" class="view-transition">
            <div class="bg-white rounded-[2.5rem] shadow-xl shadow-slate-200/50 p-6 mb-6 border border-slate-100">
                <div id="dropZone" class="relative overflow-hidden group border-2 border-dashed border-slate-200 rounded-[2rem] aspect-square flex flex-col items-center justify-center bg-slate-50 transition-all active:scale-[0.97] cursor-pointer">
                    <input type="file" id="fileInput" class="hidden" accept="image/*" capture="environment">
                    
                    <div id="uploadPrompt" class="text-center p-8">
                        <div class="bg-blue-600 p-5 rounded-3xl mb-4 inline-block shadow-lg shadow-blue-200">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                        </div>
                        <p class="font-extrabold text-lg text-slate-800">Identify New Part</p>
                        <p class="text-sm text-slate-400 mt-1">Tap to capture or upload</p>
                    </div>

                    <div id="previewContainer" class="hidden relative w-full h-full">
                        <div id="scanner" class="hidden scanner-line z-10"></div>
                        <img id="imagePreview" src="" alt="Preview" class="w-full h-full object-cover">
                        <button id="resetBtn" class="absolute top-4 right-4 bg-black/60 backdrop-blur-md text-white p-2.5 rounded-2xl hover:bg-black/80">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                </div>

                <button id="identifyBtn" class="mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white font-black py-5 rounded-[1.5rem] transition-all shadow-xl shadow-blue-200 flex items-center justify-center gap-3 disabled:bg-slate-300">
                    <span id="btnText">ANALYZE PART</span>
                    <svg id="btnIcon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                </button>
            </div>

            <!-- Current Results View -->
            <div id="results" class="hidden space-y-6">
                <div class="flex items-center justify-center p-1 bg-slate-200 rounded-2xl">
                    <button onclick="toggleResultDetail('short')" id="btn-short" class="flex-1 py-2 text-xs font-black rounded-xl bg-white shadow-sm text-blue-600 uppercase tracking-tighter">Short Answer</button>
                    <button onclick="toggleResultDetail('detailed')" id="btn-detailed" class="flex-1 py-2 text-xs font-black rounded-xl text-slate-500 uppercase tracking-tighter">Detailed Report</button>
                </div>
                
                <div id="shortResultView" class="block">
                    <div id="shortContent" class="bg-blue-600 p-8 rounded-[2.5rem] text-white shadow-2xl relative overflow-hidden">
                        <div id="shortInner"></div>
                    </div>
                </div>

                <div id="detailedResultView" class="hidden">
                    <div id="detailedContent"></div>
                    <button onclick="copyToClipboard()" class="mt-4 w-full bg-slate-100 text-slate-600 font-bold py-4 rounded-2xl text-xs uppercase tracking-widest flex items-center justify-center gap-2">
                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path></svg>
                        Copy Specs to Clipboard
                    </button>
                </div>
            </div>
        </div>

        <!-- HISTORY VIEW -->
        <div id="view-history" class="hidden space-y-6 view-transition">
            <div class="flex items-center justify-between mb-2">
                <h2 class="text-xl font-black text-slate-800 tracking-tight">Scan History</h2>
                <button onclick="clearHistory()" class="text-[10px] font-black text-slate-400 uppercase tracking-widest bg-slate-100 px-3 py-1 rounded-lg">Clear All</button>
            </div>
            <div id="historyList" class="space-y-4 pb-10">
                <div class="text-center py-20 text-slate-300">
                    <svg class="h-12 w-12 mx-auto mb-3 opacity-20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    <p class="text-xs font-bold uppercase tracking-widest">No previous scans found</p>
                </div>
            </div>
        </div>

        <!-- CATALOG VIEW -->
        <div id="view-catalog" class="hidden space-y-6 view-transition">
            <div class="bg-blue-50 border border-blue-100 p-5 rounded-3xl flex gap-4 items-start">
                <div class="bg-blue-600 p-2 rounded-xl text-white">
                    <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                </div>
                <div>
                    <h3 class="text-sm font-black text-blue-900">AI Daily Sync Active</h3>
                    <p class="text-xs text-blue-700 leading-relaxed mt-1 tracking-tight">Browsing industrial databases for 2024-2026 specs.</p>
                </div>
            </div>
            <div id="catalogList" class="space-y-4"></div>
        </div>

    </main>

    <!-- Navigation Bar -->
    <nav class="fixed bottom-0 left-0 right-0 glass-morphism border-t border-slate-100 px-8 py-4 flex justify-between items-center safe-area-bottom z-50">
        <button onclick="switchAppView('home')" class="flex flex-col items-center gap-1 group">
            <svg id="nav-home-icon" xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-blue-600 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
            </svg>
            <span id="nav-home-text" class="text-[9px] font-black uppercase tracking-widest text-blue-600 transition-colors">Scanner</span>
        </button>
        <button onclick="switchAppView('history')" class="flex flex-col items-center gap-1 group">
            <svg id="nav-history-icon" xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-slate-400 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span id="nav-history-text" class="text-[9px] font-black uppercase tracking-widest text-slate-400 transition-colors">History</span>
        </button>
        <button onclick="switchAppView('catalog')" class="flex flex-col items-center gap-1 group">
            <svg id="nav-catalog-icon" xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-slate-400 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
            </svg>
            <span id="nav-catalog-text" class="text-[9px] font-black uppercase tracking-widest text-slate-400 transition-colors">Catalog</span>
        </button>
    </nav>

    <!-- Custom Modal for Errors -->
    <div id="errorModal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-6 bg-slate-900/60 backdrop-blur-sm">
        <div class="bg-white rounded-3xl p-6 w-full max-w-sm shadow-2xl">
            <div class="flex items-center gap-3 text-red-600 mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <h3 class="font-black uppercase tracking-tighter text-sm">System Error</h3>
            </div>
            <p id="errorMsg" class="text-slate-600 text-sm font-medium mb-6 leading-relaxed">Failed to connect to AI server. Please check your internet connection or API setup.</p>
            <button onclick="document.getElementById('errorModal').classList.add('hidden')" class="w-full bg-slate-100 text-slate-800 font-black py-4 rounded-2xl text-xs uppercase tracking-widest">Close</button>
        </div>
    </div>

    <script>
        const apiKey = ""; 
        let base64Image = null;
        let scanHistory = [];
        let currentResult = null;

        const fileInput = document.getElementById('fileInput');
        const previewContainer = document.getElementById('previewContainer');
        const imagePreview = document.getElementById('imagePreview');
        const uploadPrompt = document.getElementById('uploadPrompt');
        const identifyBtn = document.getElementById('identifyBtn');
        const resetBtn = document.getElementById('resetBtn');
        const results = document.getElementById('results');
        const historyList = document.getElementById('historyList');

        function showError(msg) {
            document.getElementById('errorMsg').innerText = msg;
            document.getElementById('errorModal').classList.remove('hidden');
        }

        async function fetchWithRetry(url, options, retries = 5) {
            let delay = 1000;
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.ok) return response;
                    if (response.status === 401 || response.status === 403) {
                        throw new Error("Invalid API key. Check your configuration.");
                    }
                } catch (err) {
                    if (i === retries - 1) throw err;
                }
                await new Promise(res => setTimeout(res, delay));
                delay *= 2;
            }
        }

        function switchAppView(view) {
            ['home', 'history', 'catalog'].forEach(v => {
                document.getElementById(`view-${v}`).classList.add('hidden');
                document.getElementById(`tab-${v}`).classList.remove('bg-white', 'shadow-sm', 'text-blue-600');
                document.getElementById(`tab-${v}`).classList.add('text-slate-400');
                document.getElementById(`nav-${v}-icon`).classList.replace('text-blue-600', 'text-slate-400');
                document.getElementById(`nav-${v}-text`).classList.replace('text-blue-600', 'text-slate-400');
            });

            document.getElementById(`view-${view}`).classList.remove('hidden');
            document.getElementById(`tab-${view}`).classList.add('bg-white', 'shadow-sm', 'text-blue-600');
            document.getElementById(`nav-${view}-icon`).classList.replace('text-slate-400', 'text-blue-600');
            document.getElementById(`nav-${view}-text`).classList.replace('text-slate-400', 'text-blue-600');

            if (view === 'catalog') refreshCatalog();
            if (view === 'history') renderHistory();
        }

        function toggleResultDetail(mode) {
            const shortView = document.getElementById('shortResultView');
            const detailedView = document.getElementById('detailedResultView');
            const btnShort = document.getElementById('btn-short');
            const btnDetailed = document.getElementById('btn-detailed');

            if (mode === 'short') {
                shortView.classList.remove('hidden');
                detailedView.classList.add('hidden');
                btnShort.classList.add('bg-white', 'text-blue-600', 'shadow-sm');
                btnDetailed.classList.remove('bg-white', 'text-blue-600', 'shadow-sm');
                btnDetailed.classList.add('text-slate-500');
            } else {
                shortView.classList.add('hidden');
                detailedView.classList.remove('hidden');
                btnDetailed.classList.add('bg-white', 'text-blue-600', 'shadow-sm');
                btnShort.classList.remove('bg-white', 'text-blue-600', 'shadow-sm');
                btnShort.classList.add('text-slate-500');
            }
        }

        async function analyzePart() {
            if (!base64Image) return;

            identifyBtn.disabled = true;
            document.getElementById('scanner').classList.remove('hidden');
            document.getElementById('btnText').innerText = "SCANNING...";

            const systemPrompt = `Analyze the image. Return JSON:
            {
              "short": "Punchy 2-sentence summary",
              "detailed": {
                 "part_type": "Starter/Alternator/etc",
                 "voltage": "12V/24V",
                 "confidence_score": 95,
                 "specs": ["spec1", "spec2"],
                 "applications": ["Model A", "Model B"]
              }
            }`;

            try {
                const response = await fetchWithRetry(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            role: "user",
                            parts: [
                                { text: "Identify this part and list specs." },
                                { inlineData: { mimeType: "image/png", data: base64Image } }
                            ]
                        }],
                        systemInstruction: { parts: [{ text: systemPrompt }] },
                        generationConfig: { responseMimeType: "application/json" }
                    })
                });

                const data = await response.json();
                const resultText = data.candidates?.[0]?.content?.parts?.[0]?.text;
                if (!resultText) throw new Error("Empty response from AI.");
                
                const result = JSON.parse(resultText);
                currentResult = result;
                
                const scanEntry = {
                    id: Date.now(),
                    timestamp: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                    image: `data:image/png;base64,${base64Image}`,
                    data: result
                };
                scanHistory.unshift(scanEntry);
                
                renderAnalysis(result);
            } catch (err) {
                console.error(err);
                showError("The AI system is unavailable or the API key is invalid. Please ensure the key environment is set up correctly.");
            } finally {
                identifyBtn.disabled = false;
                document.getElementById('scanner').classList.add('hidden');
                document.getElementById('btnText').innerText = "ANALYZE PART";
            }
        }

        function renderAnalysis(data) {
            results.classList.remove('hidden');
            
            document.getElementById('shortInner').innerHTML = `
                <div class="text-[10px] font-black uppercase tracking-widest opacity-70 mb-2">Instant Summary</div>
                <p class="text-lg font-bold italic leading-tight">"${data.short}"</p>
                <div class="mt-4 inline-block bg-white text-blue-600 px-3 py-1 rounded-lg text-[10px] font-black">AI CONFIDENCE: ${data.detailed.confidence_score}%</div>
            `;

            document.getElementById('detailedContent').innerHTML = `
                <div class="bg-slate-900 p-7 rounded-[2.5rem] text-white shadow-xl">
                    <h3 class="text-2xl font-black mb-1">${data.detailed.part_type}</h3>
                    <div class="text-blue-400 text-xs font-bold uppercase tracking-widest mb-6">${data.detailed.voltage} System</div>
                    <div class="space-y-4">
                        <div class="space-y-2">
                            ${data.detailed.specs.map(s => `<div class="bg-white/5 p-3 rounded-xl border border-white/10 text-sm font-medium">${s}</div>`).join('')}
                        </div>
                        <div class="flex flex-wrap gap-2 pt-2">
                            ${data.detailed.applications.map(app => `<span class="bg-blue-600 text-[9px] font-black px-2 py-1 rounded-md uppercase tracking-wider">${app}</span>`).join('')}
                        </div>
                    </div>
                </div>
            `;

            toggleResultDetail('short');
            results.scrollIntoView({ behavior: 'smooth' });
        }

        function renderHistory() {
            if (scanHistory.length === 0) {
                historyList.innerHTML = `<div class="text-center py-20 text-slate-300"><p class="text-xs font-bold uppercase tracking-widest">No previous scans found</p></div>`;
                return;
            }

            historyList.innerHTML = scanHistory.map(item => `
                <div onclick="viewFromHistory(${item.id})" class="history-card bg-white p-4 rounded-[1.5rem] shadow-sm border border-slate-100 flex items-center gap-4 active:bg-slate-50">
                    <img src="${item.image}" class="h-16 w-16 rounded-2xl object-cover bg-slate-100 shrink-0">
                    <div class="flex-1 min-w-0">
                        <div class="flex justify-between items-start">
                            <h4 class="font-black text-slate-800 text-sm truncate">${item.data.detailed.part_type}</h4>
                            <span class="text-[9px] font-bold text-slate-400">${item.timestamp}</span>
                        </div>
                        <p class="text-[11px] text-slate-500 line-clamp-1 mt-1 font-medium">${item.data.short}</p>
                    </div>
                </div>
            `).join('');
        }

        function viewFromHistory(id) {
            const item = scanHistory.find(i => i.id === id);
            if (!item) return;
            switchAppView('home');
            imagePreview.src = item.image;
            uploadPrompt.classList.add('hidden');
            previewContainer.classList.remove('hidden');
            currentResult = item.data;
            renderAnalysis(item.data);
        }

        function clearHistory() {
            if(confirm("Clear all history?")) {
                scanHistory = [];
                renderHistory();
            }
        }

        function copyToClipboard() {
            if (!currentResult) return;
            const text = `${currentResult.detailed.part_type} (${currentResult.detailed.voltage})\n\nSpecs:\n- ${currentResult.detailed.specs.join('\n- ')}\n\nApplications: ${currentResult.detailed.applications.join(', ')}`;
            const textArea = document.createElement("textarea");
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
        }

        async function refreshCatalog() {
            const list = document.getElementById('catalogList');
            list.innerHTML = `<div class="py-20 flex flex-col items-center"><div class="h-8 w-8 border-4 border-slate-200 border-t-blue-500 rounded-full animate-spin"></div></div>`;

            try {
                const response = await fetchWithRetry(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: "List 5 latest heavy industrial parts released in 2024. Brand, part_number, category, note." }] }],
                        tools: [{ google_search: {} }],
                        generationConfig: { responseMimeType: "application/json" }
                    })
                });
                const data = await response.json();
                const itemsRaw = data.candidates?.[0]?.content?.parts?.[0]?.text;
                if (!itemsRaw) throw new Error("Catalog unavailable");
                
                const items = JSON.parse(itemsRaw);
                
                list.innerHTML = (items.updates || items).map(item => `
                    <div class="bg-white p-5 rounded-3xl shadow-sm border border-slate-100 flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <div class="h-10 w-10 bg-slate-50 rounded-xl flex items-center justify-center font-black text-[9px] text-blue-600 border border-slate-100 uppercase">${item.brand.substring(0,3)}</div>
                            <div>
                                <h4 class="font-bold text-slate-800 text-xs">${item.brand} ${item.part_number}</h4>
                                <p class="text-[10px] text-slate-400 font-medium">${item.category}</p>
                            </div>
                        </div>
                        <svg class="h-4 w-4 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </div>
                `).join('');
            } catch (err) {
                list.innerHTML = `<p class="text-center text-slate-400 py-20 text-xs">Catalog sync currently offline.</p>`;
            }
        }

        document.getElementById('dropZone').onclick = () => fileInput.click();
        fileInput.onchange = (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    base64Image = e.target.result.split(',')[1];
                    imagePreview.src = e.target.result;
                    uploadPrompt.classList.add('hidden');
                    previewContainer.classList.remove('hidden');
                    results.classList.add('hidden');
                };
                reader.readAsDataURL(file);
            }
        };

        resetBtn.onclick = (e) => {
            e.stopPropagation();
            base64Image = null;
            fileInput.value = '';
            uploadPrompt.classList.remove('hidden');
            previewContainer.classList.add('hidden');
            results.classList.add('hidden');
            currentResult = null;
        };

        identifyBtn.onclick = analyzePart;

        window.onload = () => switchAppView('home');
    </script>
</body>
</html>
